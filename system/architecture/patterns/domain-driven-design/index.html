
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cqrs/">
      
      
        <link rel="next" href="../event-sourcing/">
      
      
      <link rel="icon" href="../../../../images/dhanman-docs.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Domain-Driven Design - Dhanman Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
    
      <link rel="stylesheet" href="../../../../extra.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#domain-driven-design-in-dhanman" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Dhanman Documentation" class="md-header__button md-logo" aria-label="Dhanman Documentation" data-md-component="logo">
      
  <img src="../../../../images/dhanman-docs.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dhanman Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Domain-Driven Design
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Dhanman Documentation" class="md-nav__button md-logo" aria-label="Dhanman Documentation" data-md-component="logo">
      
  <img src="../../../../images/dhanman-docs.png" alt="logo">

    </a>
    Dhanman Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Product
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Product
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/getting-started/app-ui-structure/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/community/complaints/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Community & Engagement
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/gate-management/visitor-management/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Gate & Security
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/events-calendar/event-management/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Events & Calendar
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/financial-management/introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Financial Management
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/purchase-management/vendors/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Purchase & Vendor Management
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/inventory-assets/asset-management/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Inventory & Assets
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/payroll/employee-management/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Payroll & HR
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/water-management/meter-reading/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Water Management
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../product/reports-analytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reports & Analytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/integrations/payment-gateways/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/mobile-app/resident-app/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Mobile Applications
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/audit-compliance/audit-trails/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Audit & Compliance
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../product/users-roles/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Settings & Configuration
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    System
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design-decisions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Decisions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment-scalability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment & Scalability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Principles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diagrams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_9" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_9" id="__nav_3_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Patterns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_9">
            <span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cqrs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CQRS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Domain-Driven Design
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Domain-Driven Design
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-ddd-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core DDD Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core DDD Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ubiquitous-language" class="md-nav__link">
    <span class="md-ellipsis">
      1. Ubiquitous Language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bounded-contexts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Bounded Contexts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-context-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      3. Context Mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entities" class="md-nav__link">
    <span class="md-ellipsis">
      Entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Value Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-events" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    <span class="md-ellipsis">
      Repositories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-services" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layered-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Layered Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layered Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Layer Responsibilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tactical-patterns-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      Tactical Patterns in Practice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tactical Patterns in Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-creating-an-invoice" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Creating an Invoice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advantages-in-dhanman" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages in Dhanman
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advantages in Dhanman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-business-logic-centralization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Business Logic Centralization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-testability" class="md-nav__link">
    <span class="md-ellipsis">
      2. Testability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-flexibility" class="md-nav__link">
    <span class="md-ellipsis">
      3. Flexibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      4. Scalability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-maintainability" class="md-nav__link">
    <span class="md-ellipsis">
      5. Maintainability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      6. Evolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      Do's ✅
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#donts" class="md-nav__link">
    <span class="md-ellipsis">
      Don'ts ❌
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event-sourcing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Sourcing & Messaging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication-patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Communication Patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scheduled-jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduled Jobs (Hangfire)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resilience/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resilience & Fault Tolerance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../infrastructure/overview/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../development/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Development
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../operations/commands/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Operations
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../onboarding/developer-onboarding/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Onboarding
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../security/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Security
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-ddd-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core DDD Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core DDD Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ubiquitous-language" class="md-nav__link">
    <span class="md-ellipsis">
      1. Ubiquitous Language
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bounded-contexts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Bounded Contexts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-context-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      3. Context Mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entities" class="md-nav__link">
    <span class="md-ellipsis">
      Entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Value Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-events" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    <span class="md-ellipsis">
      Repositories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-services" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layered-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Layered Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layered Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Layer Responsibilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tactical-patterns-in-practice" class="md-nav__link">
    <span class="md-ellipsis">
      Tactical Patterns in Practice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tactical Patterns in Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-creating-an-invoice" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Creating an Invoice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advantages-in-dhanman" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages in Dhanman
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advantages in Dhanman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-business-logic-centralization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Business Logic Centralization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-testability" class="md-nav__link">
    <span class="md-ellipsis">
      2. Testability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-flexibility" class="md-nav__link">
    <span class="md-ellipsis">
      3. Flexibility
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      4. Scalability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-maintainability" class="md-nav__link">
    <span class="md-ellipsis">
      5. Maintainability
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      6. Evolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      Do's ✅
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#donts" class="md-nav__link">
    <span class="md-ellipsis">
      Don'ts ❌
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="domain-driven-design-in-dhanman">Domain-Driven Design in Dhanman<a class="headerlink" href="#domain-driven-design-in-dhanman" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p><strong>Domain-Driven Design (DDD)</strong> is a strategic approach to software development that places the business domain and domain logic at the center of the system design. Dhanman's microservices architecture is built on DDD principles, ensuring that each service models its business domain accurately and maintains clear boundaries.</p>
<hr />
<h2 id="core-ddd-concepts">Core DDD Concepts<a class="headerlink" href="#core-ddd-concepts" title="Permanent link">&para;</a></h2>
<h3 id="1-ubiquitous-language">1. Ubiquitous Language<a class="headerlink" href="#1-ubiquitous-language" title="Permanent link">&para;</a></h3>
<p>A shared language used by both developers and domain experts to describe the business domain.</p>
<p><strong>Examples in Dhanman:</strong>
- <strong>Invoice</strong>: Not just a "document" but a financial obligation with lifecycle states
- <strong>Ledger Entry</strong>: Double-entry accounting record (debit/credit)
- <strong>Resident</strong>: Not just a "user" but an apartment occupant with specific rights
- <strong>Purchase Order</strong>: Formal procurement request with approval workflow
- <strong>Salary Component</strong>: Part of payroll calculation (basic, allowances, deductions)</p>
<h3 id="2-bounded-contexts">2. Bounded Contexts<a class="headerlink" href="#2-bounded-contexts" title="Permanent link">&para;</a></h3>
<p>Clear boundaries within which a domain model is defined and applicable. Each microservice in Dhanman represents a bounded context.</p>
<table>
<thead>
<tr>
<th>Bounded Context</th>
<th>Domain Focus</th>
<th>Key Aggregates</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sales</strong></td>
<td>Revenue and invoicing</td>
<td>Invoice, Receipt, Customer</td>
</tr>
<tr>
<td><strong>Purchase</strong></td>
<td>Procurement and vendor management</td>
<td>Purchase Order, Bill, Vendor, GRN</td>
</tr>
<tr>
<td><strong>Payroll</strong></td>
<td>Employee compensation</td>
<td>Employee, Salary, Attendance</td>
</tr>
<tr>
<td><strong>Inventory</strong></td>
<td>Asset and stock management</td>
<td>Asset, Stock Item, Location</td>
</tr>
<tr>
<td><strong>Community</strong></td>
<td>Resident and facility management</td>
<td>Resident, Apartment, Facility</td>
</tr>
<tr>
<td><strong>Common</strong></td>
<td>Shared services and accounting</td>
<td>Ledger Entry, Account, Organization</td>
</tr>
</tbody>
</table>
<h3 id="3-context-mapping">3. Context Mapping<a class="headerlink" href="#3-context-mapping" title="Permanent link">&para;</a></h3>
<p>Defines relationships between bounded contexts.</p>
<div class="highlight"><pre><span></span><code>┌─────────────┐         ┌──────────────┐
│   Sales     │────────▶│   Common     │
│  (Upstream) │         │ (Downstream) │
│             │         │              │
│ Publishes:  │         │ Consumes:    │
│ - Invoice   │         │ - Invoice    │
│   Created   │         │   Created    │
└─────────────┘         └──────────────┘
      │                        ▲
      │                        │
      │                        │
      ▼                        │
┌─────────────┐         ┌──────────────┐
│   Purchase  │────────▶│              │
│  (Upstream) │         │              │
└─────────────┘         └──────────────┘
</code></pre></div>
<p><strong>Relationship Patterns:</strong>
- <strong>Shared Kernel</strong>: Common library (B2aTech.CrossCuttingConcern) shared across contexts
- <strong>Customer-Supplier</strong>: Sales/Purchase → Common (Common adapts to upstream changes)
- <strong>Published Language</strong>: Dhanman.Shared.Contracts defines event schemas
- <strong>Anti-Corruption Layer</strong>: Each service translates external events to internal model</p>
<hr />
<h2 id="building-blocks">Building Blocks<a class="headerlink" href="#building-blocks" title="Permanent link">&para;</a></h2>
<h3 id="entities">Entities<a class="headerlink" href="#entities" title="Permanent link">&para;</a></h3>
<p>Objects with unique identity that persists over time.</p>
<p><strong>Characteristics:</strong>
- Have unique identifier (usually GUID)
- Identity matters more than attributes
- Lifecycle spans multiple state changes
- Can be referenced by other entities</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Invoice</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">InvoiceNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Amount</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">InvoiceStatus</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">DueDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">CreatedAt</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">InvoiceLineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_lineItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IReadOnlyCollection</span><span class="o">&lt;</span><span class="n">InvoiceLineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">LineItems</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_lineItems</span><span class="p">.</span><span class="n">AsReadOnly</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Rich domain logic</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">Approve</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">approvalDate</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">InvoiceStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Only draft invoices can be approved&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">approvalDate</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">CreatedAt</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Approval date cannot be before creation date&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InvoiceStatus</span><span class="p">.</span><span class="n">Approved</span><span class="p">;</span>
<span class="w">        </span><span class="n">AddDomainEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InvoiceApprovedEvent</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">approvalDate</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">AddLineItem</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">InvoiceStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Cannot modify approved invoice&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">lineItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InvoiceLineItem</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">);</span>
<span class="w">        </span><span class="n">_lineItems</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lineItem</span><span class="p">);</span>
<span class="w">        </span><span class="n">RecalculateAmount</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RecalculateAmount</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lineItems</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">Quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="value-objects">Value Objects<a class="headerlink" href="#value-objects" title="Permanent link">&para;</a></h3>
<p>Objects without identity, defined by their attributes.</p>
<p><strong>Characteristics:</strong>
- No unique identifier
- Immutable
- Compared by value, not reference
- Can be shared safely</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Money</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValueObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Amount</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">currency</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="s">&quot;Amount cannot be negative&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">currency</span><span class="p">))</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="s">&quot;Currency is required&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="n">Currency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currency</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Add</span><span class="p">(</span><span class="n">Money</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Currency</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">Currency</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">&quot;Cannot add different currencies&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="n">Amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">Amount</span><span class="p">,</span><span class="w"> </span><span class="n">Currency</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">Multiply</span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">multiplier</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="n">Amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">multiplier</span><span class="p">,</span><span class="w"> </span><span class="n">Currency</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetEqualityComponents</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Amount</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Currency</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValueObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">City</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ZipCode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Address</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">street</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">zipCode</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">country</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">street</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">street</span><span class="p">));</span>
<span class="w">        </span><span class="n">City</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">city</span><span class="p">));</span>
<span class="w">        </span><span class="n">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">state</span><span class="p">));</span>
<span class="w">        </span><span class="n">ZipCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zipCode</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">zipCode</span><span class="p">));</span>
<span class="w">        </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">country</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetEqualityComponents</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Street</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">City</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">State</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ZipCode</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Country</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="aggregates">Aggregates<a class="headerlink" href="#aggregates" title="Permanent link">&para;</a></h3>
<p>Cluster of entities and value objects with defined boundaries and a single root entity.</p>
<p><strong>Characteristics:</strong>
- One entity is the Aggregate Root
- External references only to root
- Root enforces invariants
- Transaction boundary
- Loaded and saved as a unit</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="c1">// Aggregate Root</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PurchaseOrder</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregateRoot</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">OrderNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">VendorId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">POStatus</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="o">?</span><span class="w"> </span><span class="n">ApprovalDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="o">?</span><span class="w"> </span><span class="n">ApprovedBy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">PurchaseOrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IReadOnlyCollection</span><span class="o">&lt;</span><span class="n">PurchaseOrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Items</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_items</span><span class="p">.</span><span class="n">AsReadOnly</span><span class="p">();</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">POApproval</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_approvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IReadOnlyCollection</span><span class="o">&lt;</span><span class="n">POApproval</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Approvals</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_approvals</span><span class="p">.</span><span class="n">AsReadOnly</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Factory method</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">PurchaseOrder</span><span class="w"> </span><span class="nf">Create</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">vendorId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">po</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PurchaseOrder</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">(),</span>
<span class="w">            </span><span class="n">VendorId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vendorId</span><span class="p">,</span>
<span class="w">            </span><span class="n">OrderNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">,</span>
<span class="w">            </span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">,</span>
<span class="w">            </span><span class="n">OrderDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">po</span><span class="p">.</span><span class="n">AddDomainEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PurchaseOrderCreatedEvent</span><span class="p">(</span><span class="n">po</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">vendorId</span><span class="p">,</span><span class="w"> </span><span class="n">orderNumber</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">po</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Business logic encapsulated in aggregate</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">AddItem</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Cannot add items to non-draft PO&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PurchaseOrderItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">);</span>
<span class="w">        </span><span class="n">_items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">Submit</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Only draft POs can be submitted&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_items</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Cannot submit PO without items&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">PendingApproval</span><span class="p">;</span>
<span class="w">        </span><span class="n">AddDomainEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PurchaseOrderSubmittedEvent</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">OrderNumber</span><span class="p">,</span><span class="w"> </span><span class="n">GetTotalAmount</span><span class="p">()));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">Approve</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">approverId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">comments</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">PendingApproval</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Only pending POs can be approved&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">approval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">POApproval</span><span class="p">(</span><span class="n">approverId</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">,</span><span class="w"> </span><span class="n">comments</span><span class="p">);</span>
<span class="w">        </span><span class="n">_approvals</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">approval</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Business rule: requires 2 approvals for amount &gt; 50000</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetTotalAmount</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50000</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_approvals</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">(</span><span class="s">&quot;Approval recorded, awaiting second approval&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">POStatus</span><span class="p">.</span><span class="n">Approved</span><span class="p">;</span>
<span class="w">        </span><span class="n">ApprovalDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
<span class="w">        </span><span class="n">ApprovedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approverId</span><span class="p">;</span>

<span class="w">        </span><span class="n">AddDomainEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PurchaseOrderApprovedEvent</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">approverId</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="nf">GetTotalAmount</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_items</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">Quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Entity within aggregate (not aggregate root)</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PurchaseOrderItem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">PurchaseOrderId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ItemName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">UnitPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">TotalAmount</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">UnitPrice</span><span class="p">;</span>

<span class="w">    </span><span class="k">internal</span><span class="w"> </span><span class="nf">PurchaseOrderItem</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">purchaseOrderId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">itemName</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">();</span>
<span class="w">        </span><span class="n">PurchaseOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">purchaseOrderId</span><span class="p">;</span>
<span class="w">        </span><span class="n">ItemName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemName</span><span class="p">;</span>
<span class="w">        </span><span class="n">Quantity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantity</span><span class="p">;</span>
<span class="w">        </span><span class="n">UnitPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unitPrice</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Value object within aggregate</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">POApproval</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValueObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">ApproverId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">ApprovalDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Comments</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">POApproval</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">approverId</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">approvalDate</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">comments</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApproverId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approverId</span><span class="p">;</span>
<span class="w">        </span><span class="n">ApprovalDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">approvalDate</span><span class="p">;</span>
<span class="w">        </span><span class="n">Comments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comments</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetEqualityComponents</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ApproverId</span><span class="p">;</span>
<span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ApprovalDate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="domain-events">Domain Events<a class="headerlink" href="#domain-events" title="Permanent link">&para;</a></h3>
<p>Represent something significant that happened in the domain.</p>
<p><strong>Characteristics:</strong>
- Past tense naming (something happened)
- Immutable
- Contain relevant data
- Published after successful state change
- Can trigger side effects in other aggregates/services</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InvoiceCreatedEvent</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DomainEvent</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">InvoiceId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">CustomerId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">InvoiceNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Amount</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">DueDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">CreatedAt</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">InvoiceCreatedEvent</span><span class="p">(</span>
<span class="w">        </span><span class="n">Guid</span><span class="w"> </span><span class="n">invoiceId</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">Guid</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">DateTime</span><span class="w"> </span><span class="n">dueDate</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">InvoiceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoiceId</span><span class="p">;</span>
<span class="w">        </span><span class="n">CustomerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">        </span><span class="n">InvoiceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="p">;</span>
<span class="w">        </span><span class="n">Amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="n">DueDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dueDate</span><span class="p">;</span>
<span class="w">        </span><span class="n">CreatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Base class for domain events</span>
<span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DomainEvent</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Guid</span><span class="w"> </span><span class="n">EventId</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">();</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">OccurredAt</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="repositories">Repositories<a class="headerlink" href="#repositories" title="Permanent link">&para;</a></h3>
<p>Provide collection-like interface for accessing aggregates.</p>
<p><strong>Characteristics:</strong>
- One repository per aggregate root
- Abstracts persistence details
- Returns fully-formed aggregates
- Maintains aggregate boundaries</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IInvoiceRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">Invoice</span><span class="o">?&gt;</span><span class="w"> </span><span class="n">GetByIdAsync</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">Invoice</span><span class="o">?&gt;</span><span class="w"> </span><span class="n">GetByNumberAsync</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Invoice</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">GetPendingInvoicesAsync</span><span class="p">(</span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">AddAsync</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">UpdateAsync</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="nf">DeleteAsync</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Implementation</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InvoiceRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInvoiceRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">SalesDbContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">InvoiceRepository</span><span class="p">(</span><span class="n">SalesDbContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">Invoice</span><span class="o">?&gt;</span><span class="w"> </span><span class="n">GetByIdAsync</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Load entire aggregate (root + children)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">Invoices</span>
<span class="w">            </span><span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">LineItems</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">Payments</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">Id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">AddAsync</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">Invoices</span><span class="p">.</span><span class="n">AddAsync</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">SaveChangesAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Publish domain events after successful save</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nf">PublishDomainEventsAsync</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">PublishDomainEventsAsync</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">GetDomainEvents</span><span class="p">();</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">@event</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="n">_eventPublisher</span><span class="p">.</span><span class="n">PublishAsync</span><span class="p">(</span><span class="n">@event</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">invoice</span><span class="p">.</span><span class="n">ClearDomainEvents</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="domain-services">Domain Services<a class="headerlink" href="#domain-services" title="Permanent link">&para;</a></h3>
<p>Operations that don't naturally belong to an entity or value object.</p>
<p><strong>When to use:</strong>
- Operation involves multiple aggregates
- Complex calculation or algorithm
- External system integration
- Stateless behavior</p>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IInvoiceNumberGenerator</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GenerateNextNumberAsync</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">organizationId</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InvoiceNumberGenerator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInvoiceNumberGenerator</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ISalesDbContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GenerateNextNumberAsync</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">organizationId</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">lastInvoice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">Invoices</span>
<span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">OrganizationId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">organizationId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderByDescending</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">CreatedAt</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">Year</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">Month</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastInvoice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">$&quot;INV-{year}{month:D2}-0001&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Parse last number and increment</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastInvoice</span><span class="p">.</span><span class="n">InvoiceNumber</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">$&quot;INV-{year}{month:D2}-{sequence:D4}&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ILateFeeCalculator</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateLateFee</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">currentDate</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LateFeeCalculator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ILateFeeCalculator</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">FeePercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.02m</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2% per month</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">GracePeriodDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Money</span><span class="w"> </span><span class="nf">CalculateLateFee</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">currentDate</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">invoice</span><span class="p">.</span><span class="n">IsPaid</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">currentDate</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">DueDate</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="n">GracePeriodDays</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;USD&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">daysOverdue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentDate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">DueDate</span><span class="p">).</span><span class="n">Days</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">GracePeriodDays</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">monthsOverdue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Ceiling</span><span class="p">(</span><span class="n">daysOverdue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">30.0</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">lateFee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FeePercentage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="p">)</span><span class="n">monthsOverdue</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Money</span><span class="p">(</span><span class="n">lateFee</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;USD&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<hr />
<h2 id="layered-architecture">Layered Architecture<a class="headerlink" href="#layered-architecture" title="Permanent link">&para;</a></h2>
<p>Dhanman follows a clean architecture pattern aligned with DDD:</p>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────┐
│         Presentation Layer              │
│      (API Controllers, SignalR)         │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        Application Layer                │
│  (Commands, Queries, Handlers, DTOs)    │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│          Domain Layer                   │
│ (Entities, Value Objects, Aggregates,   │
│  Domain Events, Domain Services)        │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│       Infrastructure Layer              │
│ (Repositories, EF Core, RabbitMQ,       │
│  External Services)                     │
└─────────────────────────────────────────┘
</code></pre></div>
<h3 id="layer-responsibilities">Layer Responsibilities<a class="headerlink" href="#layer-responsibilities" title="Permanent link">&para;</a></h3>
<p><strong>1. Domain Layer</strong> (Core)
- Contains business logic
- No dependencies on other layers
- Defines interfaces for repositories
- Pure C# with no framework dependencies</p>
<p><strong>2. Application Layer</strong>
- Orchestrates domain objects
- Implements CQRS handlers
- Defines application services
- Maps between domain and DTOs
- Depends only on Domain layer</p>
<p><strong>3. Infrastructure Layer</strong>
- Implements repository interfaces
- Database access via EF Core
- Messaging infrastructure (RabbitMQ)
- External API integrations
- Depends on Domain and Application layers</p>
<p><strong>4. Presentation Layer</strong> (API)
- HTTP endpoints
- Request/Response models
- Authentication/Authorization
- Depends on Application layer</p>
<hr />
<h2 id="tactical-patterns-in-practice">Tactical Patterns in Practice<a class="headerlink" href="#tactical-patterns-in-practice" title="Permanent link">&para;</a></h2>
<h3 id="example-creating-an-invoice">Example: Creating an Invoice<a class="headerlink" href="#example-creating-an-invoice" title="Permanent link">&para;</a></h3>
<p><strong>1. API Endpoint (Presentation)</strong>
<div class="highlight"><pre><span></span><code><span class="na">[ApiController]</span>
<span class="na">[Route(&quot;api/[controller]</span><span class="s">&quot;)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InvoicesController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ControllerBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IMediator</span><span class="w"> </span><span class="n">_mediator</span><span class="p">;</span>

<span class="w">    </span><span class="na">[HttpPost]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">IActionResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateInvoice</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="w"> </span><span class="n">CreateInvoiceRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateInvoiceCommand</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CustomerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">LineItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">LineItems</span><span class="p">,</span>
<span class="w">            </span><span class="n">DueDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">DueDate</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_mediator</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nf">CreatedAtAction</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">GetInvoice</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">BadRequest</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>2. Command Handler (Application)</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CreateInvoiceCommandHandler</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IRequestHandler</span><span class="o">&lt;</span><span class="n">CreateInvoiceCommand</span><span class="p">,</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IInvoiceRepository</span><span class="w"> </span><span class="n">_invoiceRepository</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IInvoiceNumberGenerator</span><span class="w"> </span><span class="n">_numberGenerator</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ICustomerRepository</span><span class="w"> </span><span class="n">_customerRepository</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Handle</span><span class="p">(</span><span class="n">CreateInvoiceCommand</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validate customer exists</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_customerRepository</span><span class="p">.</span><span class="n">GetByIdAsync</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">customer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="s">&quot;Customer not found&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Generate invoice number (Domain Service)</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">_numberGenerator</span><span class="p">.</span><span class="n">GenerateNextNumberAsync</span><span class="p">(</span>
<span class="w">            </span><span class="n">customer</span><span class="p">.</span><span class="n">OrganizationId</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">cancellationToken</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Create aggregate using factory method</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">invoice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoice</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span>
<span class="w">            </span><span class="n">customer</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">            </span><span class="n">invoiceNumber</span><span class="p">,</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="n">DueDate</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Add line items</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">LineItems</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">AddLineItem</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">Quantity</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Failure</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Persist aggregate</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">_invoiceRepository</span><span class="p">.</span><span class="n">AddAsync</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Domain events automatically published by repository</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Success</span><span class="p">(</span><span class="n">invoice</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>3. Domain Model (Domain)</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Invoice</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AggregateRoot</span><span class="o">&lt;</span><span class="n">Guid</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Domain logic as shown earlier</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Invoice</span><span class="w"> </span><span class="nf">Create</span><span class="p">(</span><span class="n">Guid</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">dueDate</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">invoice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Invoice</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">(),</span>
<span class="w">            </span><span class="n">CustomerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">InvoiceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoiceNumber</span><span class="p">,</span>
<span class="w">            </span><span class="n">DueDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dueDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InvoiceStatus</span><span class="p">.</span><span class="n">Draft</span><span class="p">,</span>
<span class="w">            </span><span class="n">CreatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">invoice</span><span class="p">.</span><span class="n">AddDomainEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InvoiceCreatedEvent</span><span class="p">(</span>
<span class="w">            </span><span class="n">invoice</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
<span class="w">            </span><span class="n">customerId</span><span class="p">,</span>
<span class="w">            </span><span class="n">invoiceNumber</span><span class="p">,</span>
<span class="w">            </span><span class="mf">0m</span><span class="p">,</span><span class="w"> </span><span class="c1">// Amount calculated when line items added</span>
<span class="w">            </span><span class="n">dueDate</span>
<span class="w">        </span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">invoice</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>4. Repository Implementation (Infrastructure)</strong>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InvoiceRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInvoiceRepository</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">SalesDbContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">IEventPublisher</span><span class="w"> </span><span class="n">_eventPublisher</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">AddAsync</span><span class="p">(</span><span class="n">Invoice</span><span class="w"> </span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">Invoices</span><span class="p">.</span><span class="n">AddAsync</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="n">SaveChangesAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Publish domain events</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoice</span><span class="p">.</span><span class="n">GetDomainEvents</span><span class="p">();</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">@event</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="n">_eventPublisher</span><span class="p">.</span><span class="n">PublishAsync</span><span class="p">(</span><span class="n">@event</span><span class="p">,</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">invoice</span><span class="p">.</span><span class="n">ClearDomainEvents</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<hr />
<h2 id="advantages-in-dhanman">Advantages in Dhanman<a class="headerlink" href="#advantages-in-dhanman" title="Permanent link">&para;</a></h2>
<h3 id="1-business-logic-centralization">1. <strong>Business Logic Centralization</strong><a class="headerlink" href="#1-business-logic-centralization" title="Permanent link">&para;</a></h3>
<p>All business rules in domain layer, easy to locate and modify</p>
<h3 id="2-testability">2. <strong>Testability</strong><a class="headerlink" href="#2-testability" title="Permanent link">&para;</a></h3>
<p>Domain logic tested independently without infrastructure concerns</p>
<h3 id="3-flexibility">3. <strong>Flexibility</strong><a class="headerlink" href="#3-flexibility" title="Permanent link">&para;</a></h3>
<p>Swap implementations (e.g., change database) without affecting business logic</p>
<h3 id="4-scalability">4. <strong>Scalability</strong><a class="headerlink" href="#4-scalability" title="Permanent link">&para;</a></h3>
<p>Clear boundaries enable service decomposition</p>
<h3 id="5-maintainability">5. <strong>Maintainability</strong><a class="headerlink" href="#5-maintainability" title="Permanent link">&para;</a></h3>
<p>Ubiquitous language reduces misunderstandings</p>
<h3 id="6-evolution">6. <strong>Evolution</strong><a class="headerlink" href="#6-evolution" title="Permanent link">&para;</a></h3>
<p>Domain model evolves with business needs</p>
<hr />
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="dos">Do's ✅<a class="headerlink" href="#dos" title="Permanent link">&para;</a></h3>
<ul>
<li>Keep aggregates small and focused</li>
<li>Enforce invariants in aggregate roots</li>
<li>Use factories for complex object creation</li>
<li>Make value objects immutable</li>
<li>Publish domain events after state changes</li>
<li>Use repositories only for aggregate roots</li>
<li>Keep domain layer free of infrastructure concerns</li>
<li>Use ubiquitous language consistently</li>
</ul>
<h3 id="donts">Don'ts ❌<a class="headerlink" href="#donts" title="Permanent link">&para;</a></h3>
<ul>
<li>Don't expose aggregate internals</li>
<li>Don't navigate from one aggregate to another directly</li>
<li>Don't create "god" aggregates with too many responsibilities</li>
<li>Don't put business logic in application layer</li>
<li>Don't use domain entities in API responses (use DTOs)</li>
<li>Don't forget transaction boundaries</li>
<li>Don't over-engineer with unnecessary abstractions</li>
</ul>
<hr />
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../cqrs/">CQRS Pattern</a> — Separating reads and writes</li>
<li><a href="../event-sourcing/">Event Sourcing</a> — Event-driven architecture</li>
</ul>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Domain-Driven Design in Dhanman provides:
- Clear domain model aligned with business
- Rich behavior in domain entities
- Strong aggregate boundaries
- Event-driven communication
- Testable and maintainable codebase
- Foundation for microservices architecture</p>
<p>Each microservice implements DDD tactical patterns consistently, ensuring a robust and business-aligned architecture.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.sections", "navigation.prune"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
      
        <script src="../../../../js/extra.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../../../../js/mermaid-init.js"></script>
      
    
  </body>
</html>